* Data Management ps3
* Thursday, October 17th, 2019
* Resubmission: Thursday, October 24th, 2019
* Kristin Kelly
* Stata version 16

/***********/
/* DATA */
/***********/

/* Data from ICSPR & The Arda:

* First data set - ICSPR: Study of Women's Health Across the Nation (SWAN), 2001-2003: Visit 05
Dataset. 
"The Study of Women's Health Across the Nation (SWAN), is a multisite longitudinal, epidemiologic 
study designed to examine the health of women during their middle years. The study examines the physical, 
biological, psychological, and social changes during this transitional period."

* Second data set - ICSPR: Midlife in the United States (MIDUS) Series, 2013-2014.
"In 1995-1996, the MacArthur Midlife Research Network carried out a national survey of over 7,000 Americans 
aged 25 to 74 [ICPSR 2760]. The purpose of the study was to investigate the role of behavioral, psychological, and social 
factors in understanding age-related differences in physical and mental health."

* Third data set - ICSPR: Behavioral Risk Factor Surveillance System (BRFSS), 2003. 
"The Behavioral Risk Factor Surveillance System (BRFSS) is a state-based system of health surveys that collects 
information on health risk behaviors, preventive health practices, and health care access primarily related to 
chronic disease and injury. For many states, the BRFSS is the only available source of timely, accurate data on health-related behaviors.

* Fourth data set - ICSPR: Voice of the People, 2003. 
"This annual survey, fielded November 2003 to January 2004, was conducted in over 50 countries to 
solicit public opinion on social and political issues."

* Fifth data set - The Arda: General Social Survey, 2016.
"the General Social Survey (GSS) has been monitoring societal change and studying the growing complexity of American society."
*/ 

/**************/
/* HYPOTHESES */
/**************/
/* I started with the SWAN dataset on middle-age American women because I was interested in looking into health relations that may 
occur uniquely among that demographic. I decided to merge in more health data points, such as obesity markers, overall physical/mental health
ratings, health comparison reports, fitness levels, and average education levels, from the four additional datasets. 
My general hypotheses include:
* Women with higher reports of health comparison will also engage in more physical activity compared to women who report lower health comparisons.
* Women with higher reports of physical activity will correlate with less consumption of sweets on a daily basis.
* Women with higher reports of physical health will correlate with higher reports of mental health.
* BMI will reflect a positive relation to age, until women surpass the age of ~60 years and then BMI will begin to negatively correleate.
A lot of health correlations could be drawn from these datasets, but these hypotheseses reflect my first questions for the data.
*/

cd /Users/kristinkelly/Documents/Academic/Rutgers/Classes/Fall19/DataManagement/Stata

use "https://github.com/kekelly22/dmclass/blob/master/SWAN.dta?raw=true", clear

outsheet using ps3.csv,  replace comma nolabel
save ps3.dta,  replace nolabel
save ps3.dta,  replace nolabel

/***********/
/* looking */
/***********/

edit 

describe

/***********/
/*   PS2   */
/***********/

/****************************************************dropping***********************************************************************/
//* dropping variables not pertinent to this analysis *//
drop HRMDAY5 CYCDAY5 DHAS5 FSH5 SHBG5 T5 E2AVE5 FLGCV5 FLGDIF5 CVRDAY5 FLAGSER5 CHOLRES5 TRIGRES5 LDLRESU5 HDLRESU5 GLUCRES5 INSURES5 FACRESU5 FIBRESU5 PAIRESU5 TPARESU5 LPARESU5 LPA1RES5 APOARES5 APOBRES5 CRPRESU5 FLGCVRV5 SPSCDAY5 SPSCTIM5 SPSCMOD5 HPSCDAY5 HPSCTIM5 HPSCMOD5 SPBMDT5 HPBMDT5 //* dropping variables related to physiological/surgical health measures *//

drop BMDFLG5 EFPVITD5 EFPB125 EFPTRAN5 EFPISOF5 EFPQUER5 EFPOMEG5 EFPCOPP5 EFPMANG5 EFPPANT5 EFPDFE5  EFPFOL5 EFPVITE5 EFPZINC5 EFPANZN5 EFPB65 EFPMG5 EFPACAR5 EFPBCAR5 EFPCRYP5 EFPLUT5 EFPLYC5 EFPRET5 EFPPROA5 EFPGENI5 EFPDAID5 EFPCOUM5 EFPAIUI5 EFPARE5 EFPB15 EFPPHOS5 FRUTWK5 FRUTMON5 FATWK5 FATMON5 ALCHWK5 ALCHMON5 VEGWK5 VEGMON5 GRANWK5 GRANMON5 MEATWK5 MEATMON5 DARYWK5 DARYMON5 FVWK5 FVMON5 DTTCOPP5 DTTMANG5 DTTPANT5 BATKCAL5 BATPROT5 BATTFAT5 BATCARB5 BATPHOS5 BATPOTS5 BATRIBO5 BATNIAC5 //* dropping variables related to nutritional health measures that I won't consider in this analysis *//

drop PREVBLO5 EATDRIN5 BLDRWAT5 BLDDRAW5 SPEDAY5 ACOATW15 ACOATW25 HARTTW15 HARTTW25 CHOLTW15 CHOLTW25 BPTW15 BPTW25 DIURTW15 DIURTW25 THYRTW15 THYRTW25 INSUTW15 INSUTW25 NERVTW15 NERVTW25 STERTW15 STERTW25 FRTLTW15 FRTLTW25 BCPTWI15 BCPTWI25 ESTRTW15 ESTRTW25 EINJTW15 EINJTW25 COMBTW15 COMBTW25 PROGTW15 PROGTW25 OSTETW15 OSTETW25 ARTHTW15 ARTHTW25 OTHRTW15 OTHRTW25 PAINTW15 PAINTW25 SLEPTW15 SLEPTW25 OTCTW15 OTCTW25 OTCTW35 OTCTW45 OSTEOAR5 THYROID5 ANGINA5 OSTEOPR5 CANCERS5 SITESPE5 TAMOXIF5 CHEMOTH5 BROKEBO5 BONES15 HAPPEN15 BONES25 HAPPEN25 BONES35 HAPPEN35 DANDC5 NUMDAND5 HYSTERE5 HYSTDAY5 OOPHORE5 ONEOVAR5 ABLATIN5 UTERPRO5 THYRREM5 ENDO5 ENDODIF5 PELVCPN5 DIFPELV5 PROLAPS5 DIFPROL5 PELVCNC5 DIFCANC5 ABBLEED5 DIFBLED5 FIBRUTR5 DIFFIBR5 //* dropping variables related to blood draw and pharma health measures that I won't consider in this analysis *//

/***************************************************^dropping^***********************************************************************/

ta PRVIDER5, mi
replace PRVIDER5=-9 if (PRVIDER5==.) //* Here I'm replacing any missing values for women's healthcare. Blank or missing answers are replaced with the appropriat value label*/
recode PRVIDER5 (1 =1 "Do not have Wom Healthcare") (2 =2 "Have Wom Healthcare"), gen(WomHC) //* recoding to create a new variable specifically for all participants with or without women's healthcare.*//
drop if WomHC == -1 
drop if WomHC == -9 //* dropping participants if they did not have data for women's healthcare-- including missing, unknown and n/a answers *//
bys PRVIDER5: egen FAILOTH5_POC=mean(FAILOTH5) //* creating a new variable to tell me the average lack of healthcare for POC versus non-POC *//

ta ALCHL245, mi 
replace ALCHL245=-9 if (ALCHL245==.) //* Here I'm replacing any missing values for alchohol use. Blank or missing answers are replaced with the appropriate value label*/

ta HOTFLAS5, mi 
replace HOTFLAS5=-9 if (HOTFLAS5==.) //* I'm replacing any missing values for # of hot flashes in the past 2 weeks. Blank or missing answers are replaced with the appropriate value label */

ta RACE, mi //* checking to make sure all participants have a response for race*//
recode RACE (1 =1 "POC") (2 =1 "POC") (3 =1 "POC") (5 =1 "POC") (4 =0 "Non-POC"), gen(POC) //* recoding to create a new variable specifically for all people of color (POC) and then white/caucasian people *//

bys POC: egen FAILOTH5_POC=mean(FAILOTH5) //* creating a new variable to tell me the average lack of healthcare for POC versus non-POC *//

rename AGE5 C1PRAGE
ta C1PRAGE 
recode C1PRAGE (0/49 =1 "Under 50yo") (50/100 =2 "Over 50yo"), gen(AgeGroup) //* recoding to create a new variable specifically for women over or under 50 years old *//

keep AGE5 RACE ALCHL245 QLTYLIF5 FAILOTH5 SMOKERE5 PHYSACT5 WALKBIK5 SLEEPQL5 ENGAGSE5 WEIGHT5 BMI5 DTTKCAL5 DTTPROT5 DTTCARB5 DTTFAT5 DTTCAFF5 FAILOTH5_POC POC WomHC C1PRAGE AgeGroup/* this is where I finally realized what I wanted to keep*/

drop if SMOKERE5==. /*dropping obs missing data on smoking habits*/

drop AGE5 

save ps3.dta, clear

/******************/
/* merge: MIDUS */
/******************/

use "https://github.com/kekelly22/dmclass/blob/master/MIDUS3.dta?raw=true", clear
save MIDUS_ps3.dta, replace

keep M2ID M2FAMNUM SAMPLMAJ C1PRAGE C1PRSEX C1PA1 C1PA2 C1PA3 /*keeping the variables that I want to compare*/

drop if C1PRSEX == 1 /* dropping male observations*/

bys C1PRAGE: egen Avg_PhysH = mean(C1PA1)
bys C1PRAGE: egen Avg_MentH = mean(C1PA2)
bys C1PRAGE: egen Avg_HeaComp = mean(C1PA3) /* I created new variables with average self-evaluations of physical, mental, and comparison health for women by age */

collapse Avg_PhysH Avg_MentH Avg_HeaComp, by(C1PRAGE /* creating unique variables for average reports of physical, mental, and comparison health for women by age*/

rename AGE5 C1PRAGE /*making sure age var have the same name*/

save MIDUS_ps3.dta, replace

merge m:1 C1PRAGE using MIDUS_ps3.dta

ta _merge
drop if _merge!=3
drop _merge

save ps3.dta, clear

/***********/
/*   PS3   */
/***********/

/****************/
/* merge: BRFSS */
/****************/
/* MERGE #3: merging in data from Behavioral Risk Factor Surveillance System (BRFSS), 2003 -- merging in the average BMI-overweight and obese groups and health risk factors by age -- from ICPSR */

using "https://github.com/kekelly22/dmclass/blob/master/BRFSS.dta.zip?raw=true", clear

/* It took me forever to figure out- but I figured out how to clone my repository and have a local 
version on my laptop. Then I figured out how upload a zip file from my computer to github when it's more than 25mb. I know
you probably already know this, but you can upload data files over 25mb (but not larger than 100mb) to GitHub if you upload them
through the command in your computer's command prompt (for my Mac it's called terminal). It took a million articles and tutorials
but I finally got my biggest data set to upload this way! If it would be helpful, I could take the time to type up how I did 
this for my classmates/future students to use to upload bigger data sets to GitHub. One of the key articles I used is here:
https://help.github.com/en/github/managing-files-in-a-repository/adding-a-file-to-a-repository-using-the-command-line */

drop if NUMWOMEN < 1 /* dropping observations from male-only households or male participants*/
drop if SEX==1

keep IYEAR NUMMEN NUMWOMEN GENHLTH MARITAL EDUCA EMPLOY INCOME2 WEIGHT SEX RFHLTH BMI3CAT IMPAGE

drop if IMPAGE==99 /* dropping if age is unknown or missing */

recode IMPAGE (0/49 =1 "Under 50yo") (50/100 =2 "Over 50yo"), gen(AgeGroup) //* recoding to create a new variable specifically for women over or under 50 years old *//

rename IMPAGE C1PRAGE /* renaming age var to match between data sets */

bys C1PRAGE: egen Avg_BMIgroup = mean(BMI3CAT)
bys C1PRAGE: egen Avg_HealthRiskFac = mean(RFHLTH) /* I created new variables with average BMI group and risk factors for women by age */

drop if C1PRAGE<46
drop if C1PRAGE>58 /* dropping the obs from women younger or older than the age range of my current data set... in future management/merging would I be better off starting with one of these higher range data sets first?? */

collapse Avg_BMIgroup Avg_HealthRiskFac, by(C1PRAGE) /* creating unique variables for average reports of physical, mental, and comparison health for women by age*/

save BRFSS_ps3_.dta

merge C1PRAGE using BRFSS_ps3_.dta

ta _merge
drop if _merge!=3
drop _merge

drop NUMMEN NUMWOMEN

rename EDUCA Education 
recode Education (1 =1 "No Education") (2/3 =2 "Primary Education") (4 =3 "Secondary Education (High School)") (5/6 =4 "University degree/equivalent"), gen (EducationLevel) //* recoding to create a new variable specifically for all participants with or without women's healthcare.*//

save ps3.dta, clear

/* END MERGE #3 */


/**************/
/* merge: VOP */
/**************/


/* MERGE #4: merging in data from "Voice of the People" international data collection, 2003 -- found on ICSPR */

use "https://github.com/kekelly22/dmclass/blob/master/VoiceOfThePeople.dta?raw=true", clear

keep COUNTRY Q5 D1 D2 D3 D4 D5 D6

save "/Users/kristinkelly/Documents/Academic/Rutgers/Classes/Fall19/DataManagement/Stata/ProblemSet3/VoiceofthePeople_ps3.dta"
file /Users/kristinkelly/Documents/Academic/Rutgers/Classes/Fall19/DataManagement/Stata/ProblemSet3/VoiceofthePeople_ps3.dta saved

drop if COUNTRY!=80
drop if D1!=2

rename D1 Gender
rename D2 C1PRAGE
drop if C1PRAGE==4
rename D3 Education

recode C1PRAGE (1/2 =1 "Under 50yo") (3 =2 "Over 50yo"), gen(AgeGroup) //* recoding to create a new variable specifically for women over or under 50 years old *//

bys Education AgeGroup: egen Avg_ProspNextGen = mean(Q5)

collapse Avg_ProspNextGen, by(Education AgeGroup) /* creating unique variables for average reports of physical, mental, and comparison health for women by age*/

drop if Education==5

rename Education EducationLevel

save VOP_ps3_.dta

merge m:1 EducationLevel AgeGroup using VOP_ps3_.dta

drop if _merge!=3
drop _merge

save ps3.dta, clear

/* END MERGE #4 */

/**************/
/* merge: GSS */
/**************/
/* MERGE #5: merging in data from the General Social Survey, 2016 -- found on The Arda */

use "https://github.com/kekelly22/dmclass/blob/master/General%20Social%20Survey,%202016.DTA?raw=true", clear

keep age agekdbrn sex parborn granborn pillok premarsx

save "/Users/kristinkelly/Documents/Academic/Rutgers/Classes/Fall19/DataManagement/Stata/ProblemSet3/GSS16_ps3.dta"

drop if sex==1
drop sex
 
rename age Age

recode Age (0/49 =1 "Under 50yo") (50/100 =2 "Over 50yo"), gen(AgeGroup) //* recoding to create a new variable specifically for women over or under 50 years old *//

drop if premars==0

bys Age: egen Avg_MoralPrMaSex = mean(premarsx)

collapse Avg_MoralPrMaSex, by(Age) /* creating unique variables for average reports of physical, mental, and comparison health for women by age*/

save GSS16_ps3.dta, replace

use "/Users/kristinkelly/Documents/Academic/Rutgers/Classes/Fall19/DataManagement/Stata/ProblemSet3/ps3.dta"
rename C1PRAGE Age

merge 1:m Age using GSS16_ps3.dta

save ps3.dta, clear

/* END MERGE #5 */

/*** Citations:
Gallup International, Inc. Voice of the People, 2003. Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2009-04-28. 
 https://doi.org/10.3886/ICPSR24482.v1
 Ryff, Carol, Almeida, David, Ayanian, John, Binkley, Neil, Carr, Deborah S., Coe, Christopher, … Williams, David. Midlife in the United States (MIDUS 3), 
 2013-2014 . Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2019-04-30. https://doi.org/10.3886/ICPSR36346.v7
Smith, T. (2019, February 9). General Social Survey, 2016.
Sutton-Tyrell, Kim, Selzer, Faith, R. (Mary Francis Roy) Sowers, MaryFran, Neer, Robert, Powell, Lynda, Gold, Ellen B., … McKinlay, Sonja. Study of Women’s 
 Health Across the Nation (SWAN), 2001-2003: Visit 05 Dataset. Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2018-10-18. 
 https://doi.org/10.3886/ICPSR30501.v2
United States Department of Health and Human Services. Centers for Disease Control and Prevention. Behavioral Risk Factor Surveillance System (BRFSS), 2003. 
 Ann Arbor, MI: Inter-university Consortium for Political and Social Research [distributor], 2013-08-05. https://doi.org/10.3886/ICPSR34085.v1
***/


/* I'm so confused with why I would/should reshape and how to do that with this dataset... I guess I'm not sure what sort of variables I'm using that would be more useful being reshaped */
